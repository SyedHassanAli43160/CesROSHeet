<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Export to PDF</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        #pdf-content {
            padding: 20px;
            border: 1px solid #ccc;
            margin-bottom: 20px;
        }

        .img-fluid {
            max-width: 100%;
            height: auto;
        }

        .table th,
        .table td {
            padding: 10px;
            vertical-align: middle;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table-bordered {
            border: 1px solid #ddd;
        }

        /* Prevent page breaks in between the content */
        @media print {
            .table {
                page-break-inside: avoid;
            }

            #pdf-content {
                page-break-before: always;
            }
        }
    </style>
</head>

<body>

    <div id="pdf-content">
        <div class="row mb-3">
            <div class="col-6 text-start">
                <img src="/cesLogo.png" alt="Left Image" class="img-fluid" />
            </div>
            <div class="col-6 text-end">
                <img src="/iso.png" alt="Right Image" class="img-fluid" />
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-bordered" id="first-table">
                <tbody>
                    <tr>
                        <td style="font-weight: bold; width: 20%;">COMPANY NAME:</td>
                        <td style="width: 30%;">KIA LUCKY MOTOR</td>
                        <td style="font-weight: bold; width: 20%;">DATE/TIME:</td>
                        <td style="width: 30%;">July 03, 2022 11 am</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold;">ADDRESS:</td>
                        <td>PORT QASIM</td>
                        <td style="font-weight: bold;">SERVICE ENGINEER:</td>
                        <td>Waqar Sheikh & Noman Ali</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold;">ATTENTION:</td>
                        <td>MR. AYAZ AYUB</td>
                        <td style="font-weight: bold;">COPY TO:</td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class=" mt-5">

            <!-- Table to display the data -->
            <table class="table table-bordered" id="ro-table">
                <thead>
                    <tr>
                        <th>S. #</th>
                        <th>SECTIONS</th>
                        <th>PARAMETERS</th>
                        <th>RO # 1</th>
                        <th>RO # 2</th>
                        <th>RO # 3</th>
                        <th>RO # 4</th>

                    </tr>
                </thead>
                <tbody>
                    <!-- Pretreatment Section -->
                    <tr>
                        <td>1</td>
                        <td rowspan="5" style="text-align: center;">
                            <img src="/pretreatment.PNG" alt="Left Image" />
                        </td>
                        <td>Feed Water Temperature (Â°C)</td>
                        <td>28</td>
                        <td>28</td>
                        <td>28</td>
                        <td>28</td>

                    </tr>
                    <tr>
                        <td>2</td>
                        <td>Multimedia Inlet/Outlet (bar)</td>
                        <td>3.6/3.4</td>
                        <td>3.6/3.4</td>
                        <td>3.6/3.4</td>
                        <td>3.6/3.4</td>

                    </tr>
                    <tr>
                        <td>3</td>
                        <td>Multimedia Differential (bar)</td>
                        <td>0.2</td>
                        <td>0.2</td>
                        <td>0.2</td>
                        <td>0.2</td>

                    </tr>
                    <tr>
                        <td>4</td>
                        <td>Cartridge Filter Inlet/Outlet (bar)</td>
                        <td>3.4/2.0</td>
                        <td>3.4/2.0</td>
                        <td>3.4/2.0</td>
                        <td>3.4/2.0</td>


                    </tr>
                    <tr>
                        <td>5</td>
                        <td>Cartridge Filter Differential (bar)</td>
                        <td>1.4</td>
                        <td>1.4</td>
                        <td>1.4</td>
                        <td>1.4</td>


                    </tr>

                    <!-- Membrane Process Section -->
                    <tr>
                        <td>6</td>
                        <td rowspan="7" style="text-align: center;">
                            <img src="/membrane.PNG" alt="Left Image" />
                        </td>
                        <td>HP Pump Discharge Pressure (Psig)</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>


                    </tr>
                    <tr>
                        <td>7</td>
                        <td>Membrane Feed Pressure (A) (Psig)</td>
                        <td>156.6</td>
                        <td>156.6</td>
                        <td>156.6</td>
                        <td>156.6</td>


                    </tr>
                    <tr>
                        <td>8</td>
                        <td>Inter Stage Pressure (B) (Psig)</td>
                        <td>58</td>
                        <td>58</td>
                        <td>58</td>
                        <td>58</td>


                    </tr>
                    <tr>
                        <td>9</td>
                        <td>Reject Pressure (C) (Psig)</td>
                        <td>33.35</td>
                        <td>33.35</td>
                        <td>33.35</td>
                        <td>33.35</td>

                    </tr>
                    <tr>
                        <td>10</td>
                        <td>Differential Pressure (A-B) (Psid)</td>
                        <td>98.6</td>
                        <td>98.6</td>
                        <td>98.6</td>
                        <td>98.6</td>


                    </tr>
                    <tr>
                        <td>11</td>
                        <td>Differential Pressure (B-C) (Psid)</td>
                        <td>24.65</td>
                        <td>24.65</td>
                        <td>24.65</td>
                        <td>24.65</td>

                    </tr>
                    <tr>
                        <td>12</td>
                        <td>Differential Pressure (A-C) (Psid)</td>
                        <td>123.25</td>
                        <td>123.25</td>
                        <td>123.25</td>
                        <td>123.25</td>


                    </tr>

                    <!-- Flow Section -->
                    <tr>
                        <td>13</td>
                        <td rowspan="3" style="text-align: center;">
                            <img src="/flow.PNG" alt="Left Image" />
                        </td>
                        <td>Feed Flow Rate (m3/Hr)</td>
                        <td>27</td>
                        <td>27</td>
                        <td>27</td>
                        <td>27</td>


                    </tr>
                    <tr>
                        <td>14</td>
                        <td>Product Flow Rate (m3/Hr)</td>
                        <td>18</td>
                        <td>18</td>
                        <td>18</td>
                        <td>18</td>


                    </tr>
                    <tr>
                        <td>15</td>
                        <td>Reject Flow Rate (m3/Hr)</td>
                        <td>9</td>
                        <td>9</td>
                        <td>9</td>
                        <td>9</td>


                    </tr>

                    <!-- Performance Section -->
                    <tr>
                        <td>16</td>
                        <td rowspan="4" style="text-align: center;">
                            <img src="/performance.PNG" alt="Left Image" />
                        </td>
                        <td>Salt Passage (%)</td>
                        <td>6.3</td>
                        <td>6.3</td>
                        <td>6.3</td>
                        <td>6.3</td>


                    </tr>
                    <tr>
                        <td>17</td>
                        <td>Salt Rejection (%)</td>
                        <td>93.8</td>
                        <td>93.8</td>
                        <td>93.8</td>
                        <td>93.8</td>


                    </tr>
                    <tr>
                        <td>18</td>
                        <td>Recovery (%)</td>
                        <td>66.67</td>
                        <td>66.67</td>
                        <td>66.67</td>
                        <td>66.67</td>


                    </tr>
                    <tr>
                        <td>19</td>
                        <td>Concentration Factor</td>
                        <td>3.0</td>
                        <td>3.0</td>
                        <td>3.0</td>
                        <td>3.0</td>


                    </tr>
                </tbody>
            </table>
            <table id="test-table" class="table table-bordered">
                <thead>
                    <tr>
                        <th></th>
                        <th></th>
                        <th></th>

                        <th class="text-center" colspan="2">RO#1</th>
                        <th class="text-center" colspan="2">RO#2</th>
                        <th class="text-center" colspan="2">RO#3</th>
                        <th class="text-center" colspan="2">RO#4</th>
                    </tr>
                    <tr>
                        <th>S.#</th>
                        <th></th>
                        <th>Tests</th>
                        <th class="text-center">Feed</th>
                        <th class="text-center"> Product</th>
                        <th class="text-center">Feed</th>
                        <th class="text-center"> Product</th>
                        <th class="text-center">Feed</th>
                        <th class="text-center"> Product</th>
                        <th class="text-center">Feed</th>
                        <th class="text-center"> Product</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th>1</th>
                        <td rowspan="9" style="text-align: center;">
                            <img src="/Chemistry.jpg" alt="Left Image" />
                        </td>
                        <td>PH Value</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                    </tr>
                    <tr>
                        <th>2</th>

                        <td>Dissolved Solids(ppm CaCO3)</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                    </tr>
                    <tr>
                        <th>3</th>

                        <td>Total Alkalinity(ppm CaCO3)</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                    </tr>
                    <tr>
                        <th>4</th>

                        <td>Total Hardness(ppm CaCO3)</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>

                    </tr>
                    <tr>
                        <th>5</th>

                        <td>Calcium Hardness(ppm CaCO3)</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                    </tr>
                    <tr>
                        <th>6</th>

                        <td>Chloride(ppm Cl)</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                    </tr>
                    <tr>
                        <th>7</th>

                        <td>Total Iron(ppm Fe)</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                    </tr>
                    <tr>
                        <th>8</th>

                        <td>Free Chlorine(HOCL)</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                        <td>3.2</td>
                    </tr>
                    <tr>
                        <th>9</th>

                        <td>SDI(Salt Density Index)</td>
                        <td colspan="2">2.2</td>
                        <td colspan="2">2.2</td>
                        <td colspan="2">2.2</td>
                        <td colspan="2">2.2</td>
                    </tr>
                </tbody>
            </table>
            <!-- <table id="third-table" class="table table-bordered">
                <thead>
                    <tr>
                        <th>Test-RO#2</th>
                        <th>Feed</th>
                        <th>Product</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>PH Value</td>
                        <td>Yes</td>
                        <td>Yes</td>
                    </tr>
                    <tr>
                        <td>Dissolved Solids(ppm CaCO3)</td>
                        <td>No</td>
                        <td>No</td>
                    </tr>
                    <tr>
                        <td>Total Alkalinity(ppm CaCO3)</td>
                        <td>No</td>
                        <td>No</td>
                    </tr>
                    <tr>
                        <td>Total Hardness(ppm CaCO3)</td>
                        <td>No</td>
                        <td>No</td>
                    </tr>
                    <tr>
                        <td>Calcium Hardness(ppm CaCO3)</td>
                        <td>No</td>
                        <td>No</td>
                    </tr>
                    <tr>
                        <td>Chloride(ppm Cl)</td>
                        <td>No</td>
                        <td>No</td>
                    </tr>
                    <tr>
                        <td>Total Iron(ppm Fe)</td>
                        <td>No</td>
                        <td>No</td>
                    </tr>
                    <tr>
                        <td>Free Chlorine(HOCL)</td>
                        <td>No</td>
                        <td>No</td>
                    </tr>
                    <tr>
                        <td>SDI(Salt Density Index)</td>
                        <td></td>
                        <td>2.2</td>
                    </tr>
                </tbody>
            </table> -->
            <div>
                <label for="">Observations & Recommendation</label>
                <textarea class="form-control" rows="5" cols="5" name="" id="" readonly>Product flow has been recoverd with partial recovery of membrane feed pressure and differential pressure across membrane. The feed water in use is classfied as "Surface Water" and rich in organic foulant and fine silt with SDI 15 minutes is immeasurable and the 0.45 micron choked in 90 seconds. This is recommended to take product flow 18 m3 per hour @ 50% recovery in order to ensure smooth and trouble free operation.
                            </textarea>

            </div>
            <label for="">Chemical Dosage Profile</label>

            <table id="fourth-table" class="table table-bordered">
                <thead>

                </thead>
                <tbody>
                    <tr>
                        <td>Product</td>
                        <td>Antiscalant</td>
                        <td>Biocide</td>
                        <td>Acid</td>
                    </tr>
                    <tr>
                        <td>Recommended Dosage</td>
                        <td>5 ppm</td>
                        <td>2 ppm</td>
                        <td>1.5 ppm</td>
                    </tr>
                    <tr>
                        <td>Actual Dosage</td>
                        <td>4 ppm</td>
                        <td>2 ppm</td>
                        <td>1 ppm</td>
                    </tr>
                </tbody>
            </table>


        </div>
    </div>

    <!-- Button to trigger the PDF generation -->
    <div class="text-center mb-4">
        <button class="btn btn-primary" onclick="generatePDF()">Export as PDF</button>
    </div>

    <!-- jsPDF & autoTable Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.16/jspdf.plugin.autotable.min.js"></script>

    <script>
        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Logos (Header)
            doc.addImage("/cesLogo.png", "PNG", 10, 10, 40, 20);
            doc.addImage("/iso.png", "PNG", 160, 10, 40, 25);

            // Header Info
            let y = 45;

            // Table 1
            doc.autoTable({
                html: '#first-table',
                startY: y,
                styles: { fontSize: 8 },
                showHead: 'firstPage',
                theme: 'grid',
                tableLineColor: [0, 0, 0],
                alternateRowStyles: {},
            });

            // Update y after table 1
            y = doc.lastAutoTable.finalY + 2;

            // Table 2
            const images = {
                pretreatment: new Image(),
                membrane: new Image(),
                Flow: new Image(),
                performance: new Image(),
                chemistry: new Image()
            };
            images.pretreatment.src = '/pretreatment.png';
            images.membrane.src = '/membrane.png';
            images.Flow.src = '/flow.png';
            images.performance.src = '/performance.png';
            images.chemistry.src = '/Chemistry.jpg';
            doc.autoTable({
                html: '#ro-table',
                startY: y + 5,
                columnStyles: { 1: { halign: 'center', fillColor: [0, 0, 0, 0] } },
                theme: 'grid',
                tableLineColor: [0, 0, 0],
                alternateRowStyles: {},
                styles: { fontSize: 10 },
                showHead: 'firstPage',
                didDrawCell: function (data) {
                    // Image only in the "SECTIONS" column (index 1) of first row
                    if (data.row.index === 0 && data.column.index === 1) {
                        doc.addImage(images.pretreatment, 'PNG', data.cell.x + 10, data.cell.y + 8, 10, 25); // adjust size as needed
                    }
                    if (data.row.index === 5 && data.column.index === 1) {
                        doc.addImage(images.membrane, 'PNG', data.cell.x + 10, data.cell.y + 15, 10, 25); // adjust size as needed
                    }
                    if (data.row.index === 12 && data.column.index === 1) {
                        doc.addImage(images.Flow, 'PNG', data.cell.x + 10, data.cell.y + 0.5, 10, 25); // adjust size as needed
                    }
                    if (data.row.index === 15 && data.column.index === 1) {
                        doc.addImage(images.performance, 'PNG', data.cell.x + 10, data.cell.y + 5, 10, 25); // adjust size as needed
                    }
                },

            });


            // Update y after table 2
            y = doc.lastAutoTable.finalY + 45;

            // Table 3
            doc.autoTable({
                html: '#test-table',
                startY: y + 5,
                styles: { fontSize: 8 },
                showHead: 'firstPage', theme: 'grid',
                tableLineColor: [0, 0, 0],
                columnStyles: {
                    1: { cellWidth: 40 }, // image column

                },

                alternateRowStyles: {},
                didDrawCell: function (data) {
                    console.log('row', data.row.index, 'col', data.column.index, data.cell.text);

                    if (data.row.index === 0 && data.column.index === 1) {
                        doc.addImage(images.chemistry, 'JPG', data.cell.x + 15, data.cell.y + 12, 10, 40); // adjust as needed
                    }
                }

            });

            // Update y after table 3
            y = doc.lastAutoTable.finalY + 10;


            doc.setFontSize(12);
            doc.text("Chemical Dosage Profile", 15, y);
            y += 6;

            doc.autoTable({
                html: '#fourth-table',
                startY: y,
                styles: { fontSize: 8 },
                showHead: 'firstPage',

            });

            y = doc.lastAutoTable.finalY + 10;

            // Observations & Recommendations Text
            doc.setFontSize(12);
            doc.text("Observations & Recommendation", 15, y);
            y += 7;
            doc.setFontSize(10);

            // Wrap the textarea text manually
            const observationText = `Product flow has been recovered with partial recovery of membrane feed pressure and differential pressure across membrane. The feed water in use is classified as "Surface Water" and rich in organic foulant and fine silt with SDI 15 minutes is immeasurable and the 0.45 micron choked in 90 seconds. This is recommended to take product flow 18 m3 per hour @ 50% recovery in order to ensure smooth and trouble-free operation.`;

            const splitText = doc.splitTextToSize(observationText, 180); // Wrap text to fit page width
            doc.text(splitText, 15, y);
            y += splitText.length * 5 + 5; // Adjust Y based on number of lines

            // Get total number of pages
            const pageCount = doc.internal.getNumberOfPages();

            // Go to last page
            doc.setPage(pageCount);

            // Add signature images above footer
            const pageHeight = doc.internal.pageSize.getHeight();
            const signatureY = pageHeight - 60;  // Increase Y position for signatures to avoid footer overlap

            // Signature 1 (Service Engineer)
            doc.addImage("/serviceengineer_Signature.png", "PNG", 15, signatureY, 60, 20);  // Adjust size and position as needed
            doc.text("Service Engineer", 15, signatureY + 25);  // Label below the first signature

            // Signature 2 (Customer) moved further to the right
            const signature2X = 140; // Increased X position to move it to the right
            doc.addImage("/customer_Signature.png", "PNG", signature2X, signatureY, 60, 20);  // Adjust size and position as needed
            doc.text("Customer", signature2X + 30, signatureY + 25);  // Label below the second signature

            // Add footer image at the bottom of the last page
            doc.addImage("/footer.png", "PNG", 10, pageHeight - 20, 190, 12);  // Adjust position/size as needed
            const pageWidth = doc.internal.pageSize.getWidth();

            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setLineWidth(0.5); // Border thickness
                doc.setDrawColor(150, 150, 150);
                doc.rect(5, 5, pageWidth - 10, pageHeight - 10); // Creates a margin of 5mm all around
            }

            // Save PDF
            doc.save('RO_System_Parameters_Report.pdf');
        }
    </script>




    <!-- Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap@4.1.3/dist/js/bootstrap.min.js"
        crossorigin="anonymous"></script>

</body>

</html>